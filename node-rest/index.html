<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
<!-- This OBE tutorial: --> 
<!-- Part number: E86802-02 --> 
<!-- Published: May 2017 -->
<!-- Template date: 5/1/17 -->
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <title>Creating a Node.js RESTful API in Oracle Application Container Cloud Service</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="robots" content="INDEX, FOLLOW">
    <meta name="description" content="Learn how to create a simple REST service by using Node.js and Oracle Application Container Cloud Service.">
    <meta name="keywords" content="Oracle Application Container Cloud Service, exploration, integration">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/forms.css">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/fonts.css">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/normalize.min.css">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/main.css">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/respond-480-tablet.css">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/respond-768-laptop.css">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/respond-1140-deskop.css">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/header.css">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/footer.css">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/leftnav.css">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/simpletree.css">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/home.css">
    <!--
        <link rel="stylesheet" href="http://www.oracle.com/webfolder/technetwork/tutorials/infographics/common/css/obe_poc.css">
-->
    <link rel="stylesheet" href="./css/obe_poc.css">
    <link rel="stylesheet" href="http://docs.oracle.com/en/dcommon/css/print.css">
    <!--jquery-->
    <script src="http://docs.oracle.com/en/dcommon/js/jquery-1.11.0.min.js"></script>
    <link href="http://docs.oracle.com/en/dcommon/css/jquery-ui-1.10.4.custom.css" rel="stylesheet">
    <!--needed for tocify tutorial toc-->
    <script src="http://docs.oracle.com/en/dcommon/js/jquery-ui-1.10.4.custom.js"></script>
    <script src="http://docs.oracle.com/en/dcommon/js/jquery.tocify.jd.js"></script>
    <script src="http://docs.oracle.com/en/dcommon/js/header.js"></script>
    <script src="http://docs.oracle.com/en/dcommon/js/leftnav.js"></script>
    <!--//bootstrap components
    <link rel="stylesheet" href="./bootstrap/bootstrap.min.css"><script src="./bootstrap/bootstrap.min.js"></script>-->
    <!--fonts-->
    <!--[if lt IE 9]>
    <link rel="stylesheet" href="./css/ltIE9.css"><![endif]-->
    <!--[if IE ]>
     <link rel="stylesheet" href="./css/IE.css"> <![endif]-->
    <!--[if IE 9]>
     <link rel="stylesheet" href="./css/IE9.css"> <![endif]-->
    <!--[if gte IE 9]>
      <style type="text/css">    .gradient {       filter: none;    }
      </style><![endif]-->
    <!-- keep select menu's sticking when hit back button (DIVYA)-->
    <script>
    $(window).load(function() {
        $("select#lodpages").each(function() {
            $(this).val($(this).find('option[selected]').val());
        });
    });
    </script>
</head>

<body>
    <header>
        <div class="w1024" style="min-height:55px; display:block;">
            <a href="http://docs.oracle.com" class="oracle-logo"><img src="./img/oracle-doc-logo.png" alt="Oracle Documentation" style="max-width: none;" height="22" width="236"></a>
        </div>
    </header>
    <!--end header-->
    <div id="content">
        <h1><img src="img\obe_tag.png" align="middle" alt="Oracle by Example branding">Creating a Node.js RESTful Application in Oracle Application Container Cloud Service</h1>
        <div class="w1024" style="position:relative; margin-top:40px;">
            <div class="navbackwide border-right"></div>
            <div id="shownav" title="Show Navigation"></div>
            <div id="hidenavw" title="Hide Navigation"></div>
            <div id="sidebar">
                <div class="left-nav-tut">
                    <div id="navbar" class="left-nav-w">
                        <div id="toc" class="tocify"></div>
                    </div>
                </div>
                <script>
                $(function() {

                    var toc = $("#toc").tocify({
                        selectors: "h2,h3,h4,h5"
                    }).data("toc-tocify");

                

                    //sets options
                    toc.setOptions({
                        extendPage: false,
                        showEffect: "fadeIn",
                        smoothScroll: false
                    });

                    // Writes all of the current plugin options to the console
                    console.log(toc.options);

                });
                </script>
            </div>
            <div id="bookContainer">
                <article>
                    <div data-spy="scroll" data-target=".left-nav-w"> </div>
                    <section>
                        <h2><img src="./img/32_begin.png" alt="part 0" height="32" width="32" class="num_circ">Before You Begin</h2>
                        <p>This Oracle By Example (OBE) lab shows you how to develop a simple message board  application. Using REST calls, you can  read existing comments and create new comments on the message board.</p>
            
        
            <h3>Background</h3>
          <p>Oracle Application Container Cloud Service provides a lightweight infrastructure that lets you to deploy Java Platform, Standard Edition (SE), PHP, and Node.js applications to Oracle Cloud. You can use Node.js cloud service in Oracle Application Container Cloud Service to develop RESTful web services, and then integrate them with your client applications.</p>
                        <h3>What Do You Need?</h3>
                        <ul>
                            <li><a href="https://nodejs.org/en/" target="_blank">Node.js</a></li>
                            <li><a href="https://git-scm.com/downloads" target="_blank">Git</a> (Git CMD shell to execute cURL commands)</li>
                            <li>Access to an instance of Oracle Application Container Cloud Service</li>
                            <li><a href="https://docs.oracle.com/en/cloud/iaas/storage-cloud/cssto/selecting-replication-policy-your-service-instance.html">A storage replication policy for your service instance.</a></li>
                     
                        </ul>
                    </section>
                    <!-- ========================================================================================================================= -->
                    <section>
                        <hr>
                        <h2 id="develop" role="button" style="text-align: left;"><img src="./img/32_1.png" alt="part 1" height="32" width="32" class="num_circ">Develop a Sample RESTful Node.js Service</h2>                        <ol>
                            <li>Create a  JavaScript file and name it <code>server.js.</code></li>
                            <li>Open <code>server.js</code> in an  editor and  create a simple Node.js server.
                              <pre><code>var http = require('http');
var PORT = 8089; 
var server = http.createServer(function (request, response) {
    response.end("LATER ON, YOU WILL PLACE CODE HERE");
});

server.listen(PORT, function () {
    console.log('Server running...');
});</code></pre>
<p class="note">This  code fragment creates a  service that listens on  <code>HTTP</code> port <code>8089</code>. In a later step, you will change this port with an Oracle Application Container Cloud Service variable.</p>
                            </li>
                            <li>Test your server.
                                <pre><code>node server.js</code></pre>

                          </li>
                                <li>In a browser window,  go to <code>http://localhost:8089</code> and look for the following message: <code>"LATER ON, YOU WILL PLACE  CODE HERE."</code></li>
                                <li>To stop the server, press  CTRL+C.</li>

                            
                    
                            <li>Add the following variable declarations after the <code>var PORT</code> declaration: 
                              <pre><code>var topicList = [];
var topicDetail = {};
var currentId = 123;</code></pre></li>
                            <li>Add the following functions after the variable declarations:
                            <pre><code>function addTopic(tTitle, tText) {
   console.log("addTopic(" + tTitle + "," + tText + ")");
   var topicId = ++currentId;
   topicList.push({title: tTitle, id: topicId});
   topicDetail[topicId] = {title: tTitle, text: tText, comments: []};
   return topicId;
}

function addComment(topicId, text) {
   console.log("addComment(" + topicId + "," + text + ")");
   topicDetail[topicId].comments.push(text);
}                      </code></pre>

                            </li>
                            <li>Create sample messages.
                              <pre><code>var id1 = addTopic("Topic 1","Topic 1 content");
var id2 = addTopic("Topic 2","Topic 2 content");
addComment(id1, "Good topic");
addComment(id2, "This is a comment");
addComment(id2, "This is another comment");            </code></pre>
                            </li>
                            <li>Replace  the <code>http.createServer</code> function with the following code:
                              <pre><code>var server = http.createServer(function (request, response) {
    response.setHeader('Access-Control-Allow-Origin', '*');
    response.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS, PUT, PATCH, DELETE');
    response.setHeader('Access-Control-Allow-Headers', 'X-Requested-With,content-type');
    response.setHeader('Access-Control-Allow-Credentials', true);

    console.log('TopicList=' + JSON.stringify(topicList));
    console.log('TopicDetail=' + JSON.stringify(topicDetail));
    var requestBody = '';

    request.on('data', function (data) {
        requestBody += data;
    });

    request.on('end', function () {
        handleRequest(request, response, requestBody);
    });
});                    </code></pre>
                            </li>
                            <li>Add this function to handle the HTTP requests: 
                              <pre><code>function handleRequest(request, response, requestBody) {
    console.log(request.method + ":" + request.url + ' >>' + requestBody);

    if (request.url == '/') {
        if (request.method == 'POST') {
            var jsonMsg = JSON.parse(requestBody);
            addTopic(jsonMsg.title, jsonMsg.text);
            response.end();
        } else {
            response.end(JSON.stringify(topicList));
        }
    } else {
        var topicId = request.url.substring(1);
        if (request.method == 'POST') {
            var jsonMsg = JSON.parse(requestBody);
            addComment(jsonMsg.topicId, jsonMsg.text);
            response.end();
        } else {
            response.end(JSON.stringify(topicDetail[topicId]));
        }
    }
}           </code></pre>
                     </li>
                                                 <li>Your application must listen to requests on a port provided by an Oracle Application Container Cloud Service environment variable. In your <code>server.js</code> file, update the <code>var PORT</code> variable declaration.
                                                   <pre><code>var PORT = process.env.PORT || 80;                         </code></pre></li>
                                                   <!-- may remove this
                     <li>Download the complete <code>server.js</code> application <a href="./files/server.js">here</a>.</li> -->
                        </ol>

                  </section>
                    <hr>
                    <section>
                        <h2 id="create" role="button" style="text-align: left;"> 
                                    <img src="./img/32_2.png" alt="part 2" height="32" width="32" class="num_circ">
                                Prepare the Package for deployment</h2>
                                <p>Oracle Application Container Cloud Service requires a <code>manifest.json</code> file, which contains information about which Node.js command the service should run. </p>
                                
                        <ol>

                            <li>Create a <code>manifest.json</code> file, and add: 
                              <pre><code>{
   "runtime":{
   "majorVersion":"4"
   },
   "command": "node server.js",
   "release": {},
   "notes": ""
}</code></pre>
                          </li>
                            <li>Compress the <code>sample.js</code> and <code>manifest.json</code> files and bundle them into a single zip file named  <code>sample.zip.</code></li>
                      </ol>
                  </section>
                                                <hr>
        <section>
         <h2 id="open" role="button" style="text-align: left;"><img src="./img/32_3.png" alt="part 3" height="32" width="32" class="num_circ">Open the Oracle Application Container Cloud Service Console</h2>        
          <ol>
			  <li>In a web browser, go to  <a href="https://cloud.oracle.com/home" target="_blank">https://cloud.oracle.com/home</a>, and click <strong>Sign In.</strong></li>
			  <li>From the <strong>Cloud Account</strong> drop-down menu, select your data center, and click<strong> My Services.</strong></li>
			  <li>Enter your identity domain and click <strong>Go.</strong></li>
			  <li>Enter your cloud account credentials and click<strong> Sign In.</strong></li>       
			  <li>If Oracle Application Container Cloud Service isn't listed on the dashboard, click <strong> Customize Dashboard.</strong></li>
			  <li>Under <strong>Java</strong>, find <strong>Application Container</strong>, select <strong>Show,</strong> and then close the <strong>Customize Dashboard</strong> tab.</li> 
			  <li>On the <strong>Application Container</strong> tile, click <strong>Action Menu</strong> and select <strong>Open Service Console.</strong>
                <figure><img src="./img/deploy-node-accs-03.jpg" height="120" width="653" alt="Application Container tile" class="ScreenShot"><figcaption><a href="./files/deploy-node-accs-03.txt">Description of the illustration deploy-node-accs-03.jpg</a></figcaption></figure>
            </li>			
          </ol>
        </section>
        <hr>
        <section>
         <h2 id="deploy" role="button" style="text-align: left;"><img src="./img/32_4.png" alt="part 4" height="32" width="32" class="num_circ">Deploy the Sample Application to Oracle Application Container Cloud Service</h2>
          <ol>
			  <li>On the <strong>Applications</strong> tab, click <strong>Create Application.</strong></li>
			  <li>Select <strong>Node</strong> as the application platform.</li>
			  <li>On the <strong>Application</strong> creation page, enter or select the following values, and then click <strong>Choose File:</strong>
                                   <ul>
									<li><strong>Name:</strong> <code>Sample</code></li>
									<li><strong>Application Archive: Upload Archive</strong></li>
                                   </ul>
                                   <figure><img src="./img/deploy-node-accs-04.jpg" alt="The Application creation page" class="ScreenShot"><figcaption><a href="./files/deploy-node-accs-04.txt">Description of the illustration deploy-node-accs-04.jpg</a></figcaption></figure>              
            </li>
			  <li> In the opened file browser, navigate to the folder where you created <strong>sample.zip,</strong> select the file, and click <strong>Open.</strong>   
              <figure><img src="./img/deploy-sample-accs-04.jpg"  alt="Directory for the Sample project" class="ScreenShot"><figcaption><a href="./files/deploy-sample-accs-04.txt">Description of the illustration deploy-sample-accs-04.jpg</a></figcaption></figure>
            </li>
              <li>Click <strong>Create.</strong> Processing takes a few minutes. 
                  <figure><img src="./img/deploy-sample-accs-06.jpg" alt="Application creation in progress page" class="ScreenShot"><figcaption><a href="./files/deploy-sample-accs-06.txt">Description of the illustration deploy-sample-accs-06.jpg</a></figcaption></figure>
              </li>
			  <li>When the application is created, click <strong>OK</strong> in the confirmation dialog box.</li>
 
                                  
         
          </ol>
        </section>
                   
                    <hr>
                    <section>
                        <h2 id="messages" role="button" style="text-align: left;"> <span style="text-align: left;">
                                    <img src="./img/32_5.png" alt="part 5" height="32" width="32" class="num_circ">
                                </span><span style="text-align: left;">Test your Node.js RESTful Service using cURL</span></h2>
                        <ol>
             
            <li>Copy the application URL. If it isn't active,  refresh the Application Detail page until the URL becomes active.
				      <figure><img src="./img/test-sample-accs-07.jpg"  alt="URL on the application detail page" class="ScreenShot"><figcaption><a href="./files/test-sample-accs-07.txt">Description of the illustration test-sample-accs-07.jpg</a></figcaption></figure>
			</li>
            
             <li>In a Git CMD window, access the URL as a REST endpoint:</li>
          <pre><code>curl -i -X GET <strong><em>application URL</em></strong></code></pre> 
          <p class="note">The sample data that you entered in <code>server.js</code> is displayed:
                        </p>
                        <pre><code>HTTP/1.1 200 OK
Server: Oracle-Traffic-Director/11.1.1.9
Date: Fri, 07 Apr 2017 18:27:41 GMT
Access-control-allow-origin: *
Access-control-allow-methods: GET, POST, OPTIONS, PUT, PATCH, DELETE
Access-control-allow-headers: X-Requested-With,content-type
Access-control-allow-credentials: true
Content-length: 59
Via: 1.1 net-apaasotd
Proxy-agent: Oracle-Traffic-Director/11.1.1.9

[{"title":"Topic 1","id":124},{"title":"Topic 2","id":125}]            </code></pre>
                        <li>Add a  message.</li>
                        <pre><code>curl -i -X POST -H "Content-Type: application/json" -d '{"title":"Hello", "id":126}' <strong><em>application URL</em></strong></code></pre>
<li>Repeat step 2. The sample data is  updated.</li>
<pre><code>HTTP/1.1 200 OK
Server: Oracle-Traffic-Director/11.1.1.9
Date: Wed, 12 Apr 2017 17:19:25 GMT
Access-control-allow-origin: *
Access-control-allow-methods: GET, POST, OPTIONS, PUT, PATCH, DELETE
Access-control-allow-headers: X-Requested-With,content-type
Access-control-allow-credentials: true
Content-length: 86
Via: 1.1 net-apaasotd
Proxy-agent: Oracle-Traffic-Director/11.1.1.9

[{"title":"Topic 1","id":124},{"title":"Topic 2","id":125},{"title":"Hello","id":126}]
</code></pre>

                      </ol>

                    </section>
               
                    <hr>
                    <section>
          <h2 id="moreinfo" role="button" style="text-align: left;"><img src="./img/32_more.png" alt="more information" height="32" width="32" class="num_circ">Want to Learn More?</h2>
          <ul>
            <li>Node.js website <a href="https://nodejs.org" target="_blank">nodejs.org</a></li>
            <li><a href="http://docs.oracle.com/cloud/latest/apaas_gs/CSJSE/toc.htm" target="_blank">Using Oracle Application                                    Container Cloud Service</a></li>
          </ul>
          <hr>
        </section>
                </article>
            </div>
        </div>
    </div>
    <!--close main-->
    <!--end content-->
    <div class="footer-container ">
        <div style="max-width: 994px; padding:10px 0 0 17px;">
            <footer class="footer-list">
                <ul>
                    <li> <a href="http://www.oracle.com/corporate/index.html" target="_blank">About
                                Oracle</a> </li>
                    <li> <a href="http://www.oracle.com/us/corporate/contact/index.html" target="_blank">Contact Us</a> </li>
                    <li> <a href="http://www.oracle.com/us/legal/index.html" target="_blank">Legal
                                Notices</a> </li>
                    <li> <a href="http://www.oracle.com/us/legal/terms/index.html" target="_blank">Terms
                                of Use</a> </li>
                    <li> <a href="http://www.oracle.com/us/legal/privacy/index.html" target="_blank">Your
                                Privacy Rights</a> </li>
                    <li><a href="http://www.oracle.com/pls/topic/lookup?ctx=cpyr&id=en">Copyright ©2017, Oracle and/or its affiliates. All rights reserved.</a></li>
                </ul>
            </footer>
        </div>   
        <script language="javascript">
        var s_prefix = "OBE";
        if (typeof(document.title) != "undefined") {
            var s_pageName = s_prefix + ":" + document.title
        };
        </script>
        <script type="text/javascript" src="https://www.oracleimg.com/us/assets/metrics/ora_docs.js"></script>
</body>
</html>
